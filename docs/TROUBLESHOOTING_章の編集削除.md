# トラブルシューティング: 章の編集・削除ができない

## 問題の症状

管理画面の「章の管理」ページ（https://kampo.belong2jazz.workers.dev/admin/chapters?text_id=shanghan-lun）で、「編集」や「削除」ボタンをクリックしても何も起こらない、またはログインページにリダイレクトされる。

## 考えられる原因と解決方法

### 1. セッションタイムアウト（最も可能性が高い）

**症状**: 「編集」をクリックするとログインページにリダイレクトされる

**原因**: JWTトークンの有効期限（24時間）が切れている

**解決方法**:
1. https://kampo.belong2jazz.workers.dev/admin/login にアクセス
2. 再度ログイン:
   - ユーザーID: `mn`
   - パスワード: `39`
3. ログイン後、再度「章の管理」ページにアクセス

### 2. ブラウザのJavaScriptが無効

**症状**: 削除ボタンをクリックしても確認ダイアログが表示されない

**原因**: JavaScriptが無効になっている

**解決方法**:
1. ブラウザの設定を確認
2. JavaScriptを有効にする
3. ページをリロード（Ctrl+R または Cmd+R）

### 3. ブラウザのキャッシュ問題

**症状**: ボタンをクリックしても反応がない

**原因**: 古いJavaScriptやCSSがキャッシュされている

**解決方法**:
1. **強制リロード**: Ctrl+Shift+R（Windows）または Cmd+Shift+R（Mac）
2. または、ブラウザのキャッシュをクリア:
   - Chrome: 設定 → プライバシーとセキュリティ → 閲覧履歴データの削除
   - Firefox: 設定 → プライバシーとセキュリティ → Cookieとサイトデータ → データを消去
   - Edge: 設定 → プライバシー、検索、サービス → 閲覧データをクリア

### 4. ブラウザの拡張機能による干渉

**症状**: リンクやボタンが機能しない

**原因**: 広告ブロッカーやセキュリティ拡張機能がJavaScriptをブロックしている

**解決方法**:
1. **プライベートモード/シークレットモードで開く**:
   - Chrome: Ctrl+Shift+N
   - Firefox: Ctrl+Shift+P
   - Edge: Ctrl+Shift+N
2. または、拡張機能を一時的に無効にする

### 5. ネットワークエラー

**症状**: ページが読み込まれない、またはエラーが表示される

**原因**: インターネット接続の問題、またはCloudflareの一時的な障害

**解決方法**:
1. インターネット接続を確認
2. 数分待ってから再試行
3. ブラウザの開発者ツールでエラーを確認:
   - F12キーを押して開発者ツールを開く
   - 「Console」タブでエラーメッセージを確認
   - 「Network」タブでリクエストの状態を確認

## 確認手順

### ステップ1: ログイン状態の確認

1. https://kampo.belong2jazz.workers.dev/admin にアクセス
2. ダッシュボードが表示される → ログイン済み ✅
3. ログインページにリダイレクトされる → ログインしていない ❌

### ステップ2: 編集リンクのテスト

1. https://kampo.belong2jazz.workers.dev/admin/chapters?text_id=shanghan-lun にアクセス
2. 章の一覧が表示されることを確認
3. 任意の章の「編集」リンクをクリック
4. **期待される動作**: 編集ページ（`/admin/chapters/edit/[id]`）が開く
5. **問題がある場合**: ログインページにリダイレクトされる、またはエラーが表示される

### ステップ3: 削除ボタンのテスト

1. 章の一覧で「削除」ボタンをクリック
2. **期待される動作**: 「本当に削除しますか？」という確認ダイアログが表示される
3. **問題がある場合**: ダイアログが表示されない、またはエラーが表示される

## 開発者向けデバッグ情報

### ブラウザの開発者ツールで確認

1. **F12キーを押して開発者ツールを開く**

2. **Consoleタブを確認**:
   - JavaScriptエラーがないか確認
   - 例: `Uncaught ReferenceError: confirm is not defined`

3. **Networkタブを確認**:
   - 編集リンクをクリックしたときのリクエストを確認
   - ステータスコード:
     - `200 OK` → 正常
     - `302 Found` → リダイレクト（ログインページへ）
     - `500 Internal Server Error` → サーバーエラー

4. **Applicationタブ → Cookies を確認**:
   - `admin_token` クッキーが存在するか確認
   - パスが `/admin` になっているか確認
   - 有効期限が切れていないか確認

### エラーの報告方法

問題が解決しない場合、以下の情報を添えて報告してください:

1. **ブラウザ名とバージョン**:
   - 例: Chrome 120.0.6099.109

2. **発生している具体的な症状**:
   - 「編集をクリックするとログインページにリダイレクトされる」
   - 「削除をクリックしても何も起こらない」
   - など

3. **開発者ツールのエラーメッセージ**:
   - Consoleタブのエラー（スクリーンショット推奨）
   - Networkタブのステータスコード

4. **再現手順**:
   - 1. ログインする
   - 2. 章の管理ページにアクセス
   - 3. 編集をクリック
   - 4. → ログインページにリダイレクトされる

## 最新の修正内容（2025-11-11）

以下の修正を行いました:

1. **削除フォームのイベントハンドラー修正**:
   - `onsubmit` → `onSubmit`（JSX正しい記法）

2. **編集リンクのUI改善**:
   - ホバー時に下線を表示
   - フォント太字化
   - カーソルをポインターに変更

3. **削除ボタンのUI改善**:
   - カーソルをポインターに変更

**デプロイ済み**: Version `53d501a1-5a47-4b23-8f38-4f9c4a7c341d`

## テスト済み環境

- ✅ Chrome（最新版）
- ✅ Firefox（最新版）
- ✅ Edge（最新版）

---

## まとめ

最も一般的な原因は**セッションタイムアウト**です。再度ログインすることで解決する可能性が高いです。

それでも問題が解決しない場合は、上記の「エラーの報告方法」に従って詳細情報を提供してください。
